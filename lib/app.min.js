function isiPhone(){return navigator.platform.indexOf("iPhone")!=-1?"iphone":navigator.platform.indexOf("iPod")!=-1?"ipod":navigator.platform.indexOf("iPad")!=-1?"ipad":void 0}function tween_Colorsfalse(){drawingToolbar.children[4].name=="pencilColor"&&(drawingToolbar.children[4].visible=!1);createjs.Tween.get(pencilColor).to({alpha:0},1500)}function tween_Colorstrue(){drawingToolbar.children[4].name=="pencilColor"&&(drawingToolbar.children[4].visible=!0);createjs.Tween.get(pencilColor).to({alpha:1},1e3)}function openLyssna(){$("#toggleEditor").hide();$("#modalLyssna").openModal({complete:function(){$("#toggleEditor").show()}});clearEditTextContent()}function showPopup(n){var t=n.getAttribute("fileurl");$("#modalLarandemal").find("iframe")[0].src="/mathviewer-FK/files/kymppi/"+t+"?iframe=true";$("#modalLarandemal").openModal({ready:function(){$("#modalLarandemal").find("iframe")[0].src="/mathviewer-FK/files/kymppi/"+t+"?iframe=true"},complete:function(){$("#modalLarandemal").find("iframe")[0].src=""}})}function setMedia(n){$("#jquery_jplayer_1").jPlayer("setMedia",{mp3:"https://majemastoragelive.blob.core.windows.net/math-test/mathviewer-1B/files/kymppi/Lyssna/audio/"+n+".mp3",oga:"https://majemastoragelive.blob.core.windows.net/math-test/mathviewer-1B/files/kymppi/Lyssna/audio/"+n+".ogg"})}function setIconVisibility(n,t){$(".vilar,.viovar,.matteladan").removeClass("disabled").removeClass("waves-effect").addClass("waves-effect");t&&$(t).addClass("disabled").removeClass("waves-effect")}function GetParameterValues(n){for(var i,r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return i[1]}function activateTabs(n){var i=$(n.currentTarget).parents(".modal").attr("id"),f=$(n.currentTarget).parents(".modal").data("directory"),h=window.parent.document.getElementById(i),nt,b,d,a,v,y,w,g,t,o,u,c,s;i="#"+i;var r=null,l=0,it=$(i).attr("tabCount");if(h.dataset!==undefined){r=h.dataset.currentChapter;l=h.dataset.slideCount;r&&(r=parseInt(r));var k=$(i+" .tabs").find(".active"),p=k.data("exercise-id"),e=k.attr("href"),tt=$(i+" .contentTabs").find(".tabContent").length;for(a=1;a<=tt;a++)for(nt="#tab"+a,t=0;t<$(i+" "+nt).find("iframe").length;t++)$(i+" "+nt).find("iframe")[t].src="preloader.html?iframe=true";for(b=GetParameterValues("page"),d="",b!=""&&(b=b.split("/"),d=b[0]),t=0;t<$(i+" #tabs1").find("a").length;t++)a=$(i+" #tabs1").find("a")[t],a.className.indexOf("active")!=-1?$(a).removeClass().addClass(d).addClass("active"):$(a).removeClass().addClass(d);if(v=h.dataset.tabSlideCount,v!="undefined"&&v!=undefined&&(y=v.split(";"),y.length>1))for(w=y[0].split(","),g=y[1].split(","),t=0;t<w.length;t++)w[t]==e&&(l=g[t]);if(h.dataset.slideCount=l,$(i+" .indicators").remove(),l>0){for(o=$(i+" "+e).find(".slider ul")[0],$(o).empty(),t=0;t<l;t++)u=document.createElement("IFRAME"),c="/mathviewer-FK/files/kymppi/"+f+"/c"+r+"-ex"+p+"-s"+(t+1)+".html?iframe=true",u.setAttribute("class","pageContent"),u.setAttribute("src",c),s=document.createElement("li"),$(s).append(u),$(o).append(s);$(".slider").slider({interval:864e5,full_width:!0})}else e=="#tab1"||e=="#tab2"?(e=="#tab1"&&$("#modalViLar .tabs").css("background-color","#DDDDE3"),o=$(i+" "+e).find(".slider ul")[0],$(o).empty(),u=document.createElement("IFRAME"),c="/mathviewer-FK/files/kymppi/"+f+"/c"+r+"-ex"+p+".html?iframe=true",(f=="tincan"||f=="viovar"||f=="exercises")&&(r=$(i).attr("data-current-chapter"),c="/mathviewer-FK/files/kymppi/"+f+"/"+r+".html?iframe=true"),e=="#tab2"&&(c="/mathviewer-FK/files/kymppi/"+f+"/raknehandelser_subtraktion.html?iframe=true"),u.setAttribute("class","pageContent"),u.setAttribute("src",c),s=document.createElement("li"),$(s).append(u),$(o).append(s),$(".slider").slider({interval:864e5,full_width:!0,indicators:!1})):$(i+" "+e).find("iframe")[0].src="/mathviewer-FK/files/kymppi/"+f+"/c"+r+"-ex"+p+".html?iframe=true";h.dataset.currentFrame=0}else{r=h.getAttribute("data-current-chapter");l=h.getAttribute("data-slide-count");r&&(r=parseInt(r));var k=$(i+" .tabs").find(".active"),p=k.data("exercise-id"),e=k.attr("href");if($(i+" .indicators").remove(),v=h.getAttribute("data-tab-slide-count"),v!="undefined"&&v!=undefined&&(y=v.split(";"),y.length>1))for(w=y[0].split(","),g=y[1].split(","),t=0;t<w.length;t++)w[t]==e&&(l=g[t]);if(h.setAttribute("data-slide-count",l),l>0){for(o=$(i+" "+e).find(".slider ul")[0],$(o).empty(),t=0;t<l;t++)u=document.createElement("IFRAME"),c="/mathviewer-FK/files/kymppi/"+f+"/c"+r+"-ex"+p+"-s"+(t+1)+".html?iframe=true",u.setAttribute("class","pageContent"),u.setAttribute("src",c),s=document.createElement("li"),$(s).append(u),$(o).append(s);$(".slider").slider({interval:864e5,full_width:!0})}else e=="#tab1"?(o=$(i+" "+e).find(".slider ul")[0],$(o).empty(),u=document.createElement("IFRAME"),c="/mathviewer-FK/files/kymppi/"+f+"/c"+r+"-ex"+p+".html?iframe=true",f=="tincan"&&(r=$(i).attr("data-current-chapter"),c="/mathviewer-FK/files/kymppi/"+f+"/"+r+".html?iframe=true"),u.setAttribute("class","pageContent"),u.setAttribute("src",c),s=document.createElement("li"),$(s).append(u),$(o).append(s),$(".slider").slider({interval:864e5,full_width:!0,indicators:!1})):$(i+" "+e).find("iframe")[0].src="/mathviewer-FK/files/kymppi/"+f+"/c"+r+"-ex"+p+".html?iframe=true";h.setAttribute("data-current-frame",0)}}function addEnterKeyFocusForPopUp(){var i,r,f,t,u,e,o,n,s;try{if(r=!1,$("#modalViLar").is(":visible")?(i="#modalViLar",r=!0):$("#modalViOvar").is(":visible")&&(i="#modalViOvar",r=!0),r==!0){for(f=$($(i+" .tabs")[0]).find(".shown"),t=0,n=0;n<f.length;n++)if($(f[n].children[0]).hasClass("active")){t=n;break}if(u=$($(i+" .slider .slides"))[t],e=0,t<2){for(n=0;n<u.children.length;n++)if($(u.children[n]).attr("class").trim()=="active"){e=n;break}o=$($($(u).find(".pageContent")[e]).contents()[0]).find(".hdnFocusInput")[0]}else s=t+1,o=$($("#tab"+s+" .pageContent").contents()[0]).find(".hdnFocusInput")[0];$(o).focus()}}catch(h){}}function setETxtIconVisiblity(n){grpTrash.visible(n);grpErase.visible(n);grpTxt.visible(n);grpPencil.visible(n);layer.draw()}function Log(n,t,i){if(t)if(i){var r=$(n).data("LogCount");r||(r=0);$(n).html(r+++" --> "+t+"<br />"+$(n).html()).data("LogCount",r)}else $(n).html(t+"<br />"+$(n).html());else LogConsole(n,"log")}function init(){drawingStageImages=drawingStageImages||{};lib=lib||{};var n=new createjs.LoadQueue(!0,null,!0);n.addEventListener("fileload",function(n){n.item.type=="image"&&(drawingStageImages[n.item.id]=n.result)});n.addEventListener("complete",handleComplete);n.loadManifest(drawingStageManifest)}function handleComplete(){function vt(n,t){var i,r,u;if(n.isHidden){for(i=0;i<nt.length;i++)r=1500,u=!0,nt[i].sizing===t&&(r=0,u=!1),createjs.Tween.get(nt[i].sizing).to({scaleX:0,scaleY:0,alpha:0},r),nt[i].extras.isHidden=u;createjs.Tween.get(t).to({scaleX:t.originalScaleX,scaleY:t.originalScaleY,alpha:1},1500).call(function(){})}else createjs.Tween.get(t).to({scaleX:t.originalScaleX,scaleY:t.originalScaleY,alpha:1},0).to({scaleX:0,scaleY:0,alpha:0},1500).call(function(){});n.isHidden=!n.isHidden}var nt,o,l,ot,st,ht,ct,c,yt,i,a,r,w,f,it,lt,at,e,u,t,s,h,n,ft,et,g;for(drawingStage.canvas.width=drawingStage.canvas.clientWidth,drawingStage.canvas.height=drawingStage.canvas.clientHeight,createjs.Ticker.addEventListener("tick",drawingStage),(lib.pencilIcon=function(){this.initialize(drawingStageImages.pencil)}).prototype=p=new createjs.Bitmap,p.virtualBounds=new createjs.Rectangle(0,0,121,121),(lib.lassoIcon=function(){this.initialize(drawingStageImages.lasso)}).prototype=p=new createjs.Bitmap,p.virtualBounds=new createjs.Rectangle(0,0,121,121),(lib.eraserIcon=function(){this.initialize(drawingStageImages.eraser)}).prototype=p=new createjs.Bitmap,p.virtualBounds=new createjs.Rectangle(0,0,121,121),(lib.colorIcon=function(){this.initialize(drawingStageImages.color)}).prototype=p=new createjs.Bitmap,p.virtualBounds=new createjs.Rectangle(0,0,121,121),(lib.clearScreenIcon=function(){this.initialize(drawingStageImages.clearScreen)}).prototype=p=new createjs.Bitmap,p.virtualBounds=new createjs.Rectangle(0,0,121,121),(lib.editTextIcon=function(){this.initialize(drawingStageImages.text_T)}).prototype=p=new createjs.Bitmap,p.virtualBounds=new createjs.Rectangle(0,0,121,121),nt=[],pencil=new lib.pencilIcon,pencil.scaleX=.5,pencil.scaleY=.5,pencil.x=50,pencil.y=-10,pencil.visible=!1,pencil.mouseEnabled=!1,eraser=new lib.eraserIcon,eraser.scaleX=.5,eraser.scaleY=.5,eraser.x=50,eraser.y=50,eraser.visible=!1,eraser.mouseEnabled=!1,o=new lib.editTextIcon,o.scaleX=.21,o.scaleY=.21,o.x=0,o.y=0,o.visible=!1,o.mouseEnabled=!1,l=new createjs.Shape,l.graphics.f("rgba(255, 255, 255, 1)").ss("rgba(142, 184, 48, 1)").s(1).drawCircle(0,0,50),ot=new createjs.Shape,ot.graphics.f("#0C94BA").ss("#0C94BA").s(.5).drawCircle(0,0,45),ot.setTransform(-419,-410),ot.addEventListener("click",function(){pencilDrawcolor="#0C94BA";tween_Colorsfalse();pencilVisible=!1}),st=new createjs.Shape,st.graphics.f("#FFD303").ss("#FFD303").s(.5).drawCircle(0,0,45),st.setTransform(-419,-310),st.addEventListener("click",function(){pencilDrawcolor="#FFD303";tween_Colorsfalse();pencilVisible=!1}),ht=new createjs.Shape,ht.graphics.f("#DA3A71").ss("#DA3A71").s(.5).drawCircle(0,0,45),ht.setTransform(-419,-210),ht.addEventListener("click",function(){pencilDrawcolor="#DA3A71";tween_Colorsfalse();pencilVisible=!1}),ct=new createjs.Shape,ct.graphics.f("#80C341").ss("#80C341").s(.5).drawCircle(0,0,45),ct.setTransform(-419,-110),ct.addEventListener("click",function(){pencilDrawcolor="#80C341";tween_Colorsfalse();pencilVisible=!1}),pencilColor.addChild(ot,st,ht,ct),pencilColor.visible=!1,pencilColor.name="pencilColor",pencilColor.setTransform(0,0),pencilColor.visible=!0,c=new createjs.Container,yt=l.clone(!0),pencilTool=new lib.pencilIcon,pencilTool.shadow=new createjs.Shadow("rgba(162, 189, 48, 1)",5,5,10),pencilTool.scaleX=.4,pencilTool.scaleY=.4,pencilTool.x=-25,pencilTool.y=-50,i=new createjs.Container,u=0,n=1;n<=8;n++)t=new createjs.Shape,t.value=5*n,u=u+10*n,t.graphics.f("#000000").drawCircle(0,0,5*n),t.x=-u,t.y=0,i.addChild(t),t.addEventListener("click",function(n){drawingStage.toolWidth=n.currentTarget.value;pencil.scaleX=pencil.scaleY=(drawingStage.toolWidth+100)/100;i.sizeSelected.graphics.clear().f().ss(2).s("#ff0000").drawCircle(n.currentTarget.x,n.currentTarget.y,n.currentTarget.value+1)});i.sizeSelected=new createjs.Shape;i.sizeSelected.graphics.f().ss("#ff0000");i.addChild(i.sizeSelected);i.setTransform(-90,0);i.alpha=0;i.originalScaleX=i.scaleX;i.originalScaleY=i.scaleY;a=new createjs.Shape;a.graphics.f("rgba(162, 189, 48, 1)").drawPolyStar(-60,0,20,3,.6,-60);a.isHidden=!0;a.addEventListener("mousedown",function(){vt(a,i)});c.addChild(yt,pencilTool,i);c.setTransform(0,0);c.hideTool=!0;var v=new createjs.Container,wt=l.clone(!0),y=new lib.eraserIcon;for(y.shadow=new createjs.Shadow("rgba(162, 189, 48, 1)",5,5,10),y.scaleX=.5,y.scaleY=.5,y.x=-30,y.y=-40,r=new createjs.Container,u=0,n=1;n<=8;n++)t=new createjs.Shape,t.value=5*n,u=u+10*n,t.graphics.f("#000000").drawCircle(0,0,5*n),t.x=-u,t.y=0,r.addChild(t),t.addEventListener("click",function(n){drawingStage.toolWidth=n.currentTarget.value;eraser.scaleX=eraser.scaleY=.5*((drawingStage.toolWidth+100)/100);r.sizeSelected.graphics.clear().f().ss(2).s("#ff0000").drawCircle(n.currentTarget.x,n.currentTarget.y,n.currentTarget.value+1)});r.sizeSelected=new createjs.Shape;r.sizeSelected.graphics.f().ss("#ff0000");r.addChild(r.sizeSelected);r.setTransform(-90,0);r.alpha=0;r.originalScaleX=r.scaleX;r.originalScaleY=r.scaleY;w=new createjs.Shape;w.graphics.f("rgba(162, 189, 48, 1)").drawPolyStar(-60,0,20,3,.6,-60);w.isHidden=!0;w.addEventListener("mousedown",function(){vt(w,r)});v.addChild(wt,y,r);v.setTransform(0,110);v.hideTool=!0;var pt=new createjs.Container,bt=l.clone(!0),tt=new lib.colorIcon;for(tt.shadow=new createjs.Shadow("rgba(162, 189, 48, 1)",5,5,10),tt.scaleX=.5,tt.scaleY=.5,tt.x=-25,tt.y=-35,f=new createjs.Container,u=0,n=1;n<=8;n++)t=new createjs.Shape,t.value=5*n,u=u+10*n,t.graphics.f("#000000").drawCircle(0,0,5*n),t.x=-u,t.y=0,f.addChild(t),t.addEventListener("click",function(n){drawingStage.toolWidth=n.currentTarget.value;color.scaleX=color.scaleY=.5*((drawingStage.toolWidth+100)/100);f.sizeSelected.graphics.clear().f().ss(2).s("#ff0000").drawCircle(n.currentTarget.x,n.currentTarget.y,n.currentTarget.value+1)});f.sizeSelected=new createjs.Shape;f.sizeSelected.graphics.f().ss("#ff0000");f.addChild(f.sizeSelected);f.setTransform(-90,0);f.alpha=0;f.originalScaleX=f.scaleX;f.originalScaleY=f.scaleY;it=new createjs.Shape;it.graphics.f("rgba(162, 189, 48, 1)").drawPolyStar(-60,0,20,3,.6,-60);it.isHidden=!0;it.addEventListener("mousedown",function(){vt(it,f)});pt.addChild(bt,tt,f,it);pt.setTransform(0,220);pt.hideTool=!0;var b=new createjs.Container,kt=l.clone(!0),rt=new lib.clearScreenIcon;rt.shadow=new createjs.Shadow("rgba(162, 189, 48, 1)",5,5,10);rt.scaleX=.5;rt.scaleY=.5;rt.x=-30;rt.y=-30;b.addChild(kt,rt);b.setTransform(0,330);b.hideTool=!0;var k=new createjs.Container,dt=l.clone(!0),ut=new lib.editTextIcon;for(ut.shadow=new createjs.Shadow("rgba(162, 189, 48, 1)",5,5,10),ut.scaleX=.5,ut.scaleY=.5,ut.x=-30,ut.y=-30,k.addChild(dt,ut),k.setTransform(0,330),k.hideTool=!0,lt=new createjs.Container,at=new createjs.Shape,at.graphics.f("rgba(142, 184, 48, 1)").ss("#000000").drawCircle(0,0,50),lassoTool=new lib.lassoIcon,lassoTool.shadow=new createjs.Shadow("rgba(162, 189, 48, 1)",5,5,10),lassoTool.scaleX=1.5,lassoTool.scaleY=1.5,lassoTool.x=-25,lassoTool.y=-25,e=new createjs.Container,u=0,n=1;n<=8;n++)t=new createjs.Shape,t.value=5*n,u=u+10*n,t.graphics.f("#000000").drawCircle(-u,0,5*n),e.addChild(t),t.addEventListener("click",function(n){drawingStage.toolWidth=n.currentTarget.value;lasso.scaleX=lasso.scaleY=(drawingStage.toolWidth+100)/100});for(e.setTransform(-90,0),e.alpha=0,e.originalScaleX=e.scaleX,e.originalScaleY=e.scaleY,s=new createjs.Shape,s.graphics.f("rgba(162, 189, 48, 1)").drawPolyStar(-60,0,20,3,.6,-60),s.isHidden=!0,s.cursor="pointer",s.addEventListener("mousedown",function(){vt(s,e)}),lt.hideTool=!0,lt.addChild(at,lassoTool,e,s),lt.setTransform(0,450),h=[],h.push(k),h.push(c),h.push(v),h.push(b),h.push(pencilColor),n=0;n<h.length;n++)h[n].setTransform(100+140*n,-35),drawingToolbar.addChild(h[n]);drawingToolbar.setTransform(drawingStage.canvas.width-50,drawingStage.canvas.height-120,.38,.38);drawingToolbar.x=parseInt($("#toggler").css("left").replace("px",""))+130;var gt=/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1])==9,ni=/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1])==10,d=0;isEdge?d=screen.width==2560&&screen.height==1440?-5:screen.width==1920&&screen.height==1200?-10:screen.width==1600&&screen.height==1024?0:screen.width==1280&&screen.height==1050?0:0:isIExplorer?d=gt?screen.width==2560&&screen.height==1440?-10:screen.width==1920&&screen.height==1200?-15:screen.width==1600&&screen.height==1024?0:screen.width==1280&&screen.height==1050?0:0:ni?screen.width==2560&&screen.height==1440?-8:screen.width==1920&&screen.height==1200?-15:screen.width==1600&&screen.height==1024?0:screen.width==1280&&screen.height==1050?0:0:screen.width==2560&&screen.height==1440?-5:screen.width==1920&&screen.height==1200?-10:screen.width==1600&&screen.height==1024?0:screen.width==1280&&screen.height==1050?0:0:isFirefox?d=screen.width==2560&&screen.height==1440?-16:screen.width==1920&&screen.height==1200?-26:screen.width==1600&&screen.height==1024?0:screen.width==1280&&screen.height==1050?0:0:isiPad?screen.width==768&&screen.height==1024&&Math.abs(window.orientation)===90?d=0:screen.width==768&&screen.height==1024&&(d=0):d=screen.width==2560&&screen.height==1440?-10:screen.width==1920&&screen.height==1200?-20:screen.width==1600&&screen.height==1024?0:0;drawingToolbar.y=drawingStage.canvas.height-parseInt($("#toggler").css("bottom").replace("px",""))-23+d;reTransEditText();drawingStage.toolWidth=15;eraser.scaleX=eraser.scaleY=.5*((drawingStage.toolWidth+100)/100);drawingStage.toolWidth=4;pencil.scaleX=pencil.scaleY=(drawingStage.toolWidth+100)/100;ft=new createjs.Container;ft.hitArea=new createjs.Shape((new createjs.Graphics).f("#000888").dr(0,0,drawingStage.canvas.width,drawingStage.canvas.height));ft.cache(0,0,drawingStage.canvas.width,drawingStage.canvas.height);drawingStage.addChild(ft);et=new createjs.Shape;ft.addChild(et);drawingStage.addChild(drawingToolbar,pencil,eraser,o);v.addEventListener("mousedown",function(n){erase=!0;eraser.x=n.stageX+eraserDiffX;eraser.y=n.stageY+eraserDiffY*eraser.scaleY-150;pencil.visible=!1;eraser.visible=!0;tween_Colorsfalse();pencilVisible=!1;drawingStage.toolWidth=30});v.addEventListener("mouseover",iconHover);v.addEventListener("mouseout",iconOut);pencilDiffY=-180;pencilDiffX=0;eraserDiffY=-90;eraserDiffX=-15;c.addEventListener("mousedown",function(n){erase=!1;pencil.x=n.stageX+pencilDiffX;pencil.y=n.stageY+pencilDiffY*pencil.scaleY;pencil.visible=!0;eraser.visible=!1;pencilVisible==!0?(pencilVisible=!1,tween_Colorsfalse(),pencilVisible=!1):(tween_Colorstrue(),pencilVisible=!0);pencilDrawcolor="#000000";drawingStage.toolWidth=4});c.addEventListener("mouseover",iconHover);c.addEventListener("mouseout",iconOut);b.addEventListener("mousedown",function(){tween_Colorsfalse();pencilVisible=!1;eraser.visible=!1;clearEditTextContent();hideEditText("pencil");setETxtIconVisiblity(!0)});b.addEventListener("mouseover",iconHover);b.addEventListener("mouseout",iconOut);k.addEventListener("mousedown",function(){pencil.visible=!1;eraser.visible=!1;isFirst=!0;showEditText();setETxtIconVisiblity(!0)});k.addEventListener("mouseover",iconHover);k.addEventListener("mouseout",iconOut);g=new createjs.Point;drawingStage.mouseChildren=!0;nt.push({extras:a,sizing:i},{extras:w,sizing:r},{extras:s,sizing:e});a.hideTool=!0;w.hideTool=!0;s.hideTool=!0;pencilTool.hideTool=!0;y.hideTool=!0;lassoTool.hideTool=!0;yt.hideTool=!0;wt.hideTool=!0;at.hideTool=!0;i.hideTool=!0;r.hideTool=!0;e.hideTool=!0;drawingStage.on("stagemousemove",function(n){var r,i,t,u,f;if(o.visible=!1,$("#drawingTool").attr("class")!="invisible"){for(r=drawingStage.getObjectsUnderPoint(n.stageX,n.stageY),hideTool=!1,i=0;i<r.length;i++)(r[i].hideTool||r[i].parent&&r[i].parent.hideTool)&&(hideTool=!0);if(t=null,isEditTextLayer==!0){if(isHoverEditText==!0)return;o.visible=!0;t=o;u=pencilDiffX-10;f=pencilDiffY+145}else erase?(t=eraser,u=eraserDiffX,f=eraserDiffY*eraser.scaleY):(t=pencil,u=pencilDiffX,f=pencilDiffY*pencil.scaleY);hideTool?t.visible=!1:(t.visible=!0,t.x=n.stageX+u,t.y=n.stageY+f)}});drawingStage.addEventListener("mousedown",function(n){if($("#drawingTool").attr("class")!="iconHover"){var t=null,i,r;erase?(t=eraser,i=eraserDiffX,r=eraserDiffY*eraser.scaleY,pencil.visible=!1):(t=pencil,i=pencilDiffX,r=pencilDiffY*pencil.scaleY,eraser.visible=!1);g.x=n.stageX;g.y=n.stageY;t.x=n.stageX+i;t.y=n.stageY+r;n.addEventListener("mousemove",function(n){t.x=n.stageX+i;t.y=n.stageY+r;t.cursor="pointer";et.graphics.ss(drawingStage.toolWidth,"round").s(pencilDrawcolor);et.graphics.mt(g.x,g.y);et.graphics.lt(n.stageX,n.stageY);g.x=n.stageX;g.y=n.stageY;ft.updateCache(erase?"destination-out":"source-over");et.graphics.clear()})}})}function showEditText(){$(".kineticjs-content").css({position:"absolute","z-index":"4"});$($("#drawingTool canvas")[1]).css({"z-index":"3"});isEditTextLayer=!0;drawingToolbar.visible=!1}function hideEditText(n){n=n==undefined?"":n;n=="trash"?(clearEditTextContent(),showEditText(),setETxtIconVisiblity(!0),setTimeout(function(){setETxtIconVisiblity(!0)},40)):($(".kineticjs-content").css({position:"absolute","z-index":"3"}),$($("#drawingTool canvas")[1]).css({"z-index":"4"}),isEditTextLayer=!1,drawingToolbar.visible=!0,n=="pencil"?(tween_Colorstrue(),pencilVisible=!0,erase=!1,drawingStage.toolWidth=4):n=="eraser"&&(erase=!0,drawingStage.toolWidth=30))}function clearEditTextContent(){stage!=undefined&&(stage.destroy(),addEditableText(),layer.draw());drawingStage.children[0].uncache();drawingStage.children[0].cache(0,0,drawingStage.canvas.width,drawingStage.canvas.height)}function iconHover(){$("#drawingTool").addClass("iconHover");document.body.style.cursor="pointer"}function iconOut(){$("#drawingTool").removeClass("iconHover");document.body.style.cursor="text"}function reTransEditText(){try{grpTxt.children.length>0&&(grpTxt.children[0].attrs.x=drawingToolbar.x+drawingToolbar.children[0].x+drawingToolbar.children[0].children[0].x-62,grpTxt.children[0].attrs.y=drawingToolbar.y+drawingToolbar.children[0].y+drawingToolbar.children[0].children[0].y+22,grpTxt.children[1].attrs.x=drawingToolbar.x+drawingToolbar.children[0].x+drawingToolbar.children[0].children[1].x+18-62,grpTxt.children[1].attrs.y=drawingToolbar.y+drawingToolbar.children[0].y+drawingToolbar.children[0].children[1].y+18+22,grpPencil.children[0].attrs.x=drawingToolbar.x+drawingToolbar.children[1].x+drawingToolbar.children[1].children[0].x-149,grpPencil.children[0].attrs.y=drawingToolbar.y+drawingToolbar.children[1].y+drawingToolbar.children[1].children[0].y+22,grpPencil.children[1].attrs.x=drawingToolbar.x+drawingToolbar.children[1].x+drawingToolbar.children[1].children[1].x+15-149,grpPencil.children[1].attrs.y=drawingToolbar.y+drawingToolbar.children[1].y+drawingToolbar.children[1].children[1].y+33+22,grpErase.children[0].attrs.x=drawingToolbar.x+drawingToolbar.children[2].x+drawingToolbar.children[2].children[0].x-235.5,grpErase.children[0].attrs.y=drawingToolbar.y+drawingToolbar.children[2].y+drawingToolbar.children[2].children[0].y+22,grpErase.children[1].attrs.x=drawingToolbar.x+drawingToolbar.children[2].x+drawingToolbar.children[2].children[1].x+18-235.5,grpErase.children[1].attrs.y=drawingToolbar.y+drawingToolbar.children[2].y+drawingToolbar.children[2].children[1].y+24+22,grpTrash.children[0].attrs.x=drawingToolbar.x+drawingToolbar.children[3].x+drawingToolbar.children[3].children[0].x-322,grpTrash.children[0].attrs.y=drawingToolbar.y+drawingToolbar.children[3].y+drawingToolbar.children[3].children[0].y+22,grpTrash.children[1].attrs.x=drawingToolbar.x+drawingToolbar.children[3].x+drawingToolbar.children[3].children[1].x+18-322,grpTrash.children[1].attrs.y=drawingToolbar.y+drawingToolbar.children[3].y+drawingToolbar.children[3].children[1].y+18+22)}catch(n){}}function addEditableText(){function o(){try{layer.children.length>2&&(layer.children[layer.children.length-1].nodeType=="Group"&&layer.children[layer.children.length-1].children[0].textArr[0].text==""?layer.children.pop():(layer.children[layer.children.length-3].className=="EditableText"||layer.children[layer.children.length-3].className=="Text")&&layer.children[layer.children.length-3].textArr[0].text==""&&(layer.children.pop(),layer.children.pop(),layer.children.pop(),o()))}catch(n){}}function s(){o();isFirst=!0;this.name=="pencil"?(tween_Colorstrue(),pencilVisible=!0):(tween_Colorsfalse(),pencilVisible=!1);hideEditText(this.name);layer.draw()}function i(){var n=$("#container-editText");return{left:n.scrollLeft()-n.offset().left,top:n.scrollTop()-n.offset().top}}var n=window.Kinetic,r,u,f,e;stage=new n.Stage({container:"container-editText",width:$(window).width(),height:$(window).height()});layer=new n.Layer;grpTxt=new n.Group;r=new Image;r.src="files/kymppi/exercises/images/text_T.png";r.onload=function(){txtBtnIcon=new n.Image({shadowColor:"#a2bd30",shadowBlur:2,shadowOffset:{x:5,y:5},shadowOpacity:.5,x:0,y:0,image:r,width:25,height:25});var t=new n.Circle({radius:19,x:0,y:0,fill:"#ffffff",stroke:"#847f7f",strokeWidth:1.5});grpTxt.add(t);grpTxt.add(txtBtnIcon);grpTxt.on("mouseover",iconHover);grpTxt.on("mouseout",iconOut);grpTxt.visible(!1);layer.add(grpTxt);layer.draw()};grpPencil=new n.Group;u=new Image;u.src="files/kymppi/exercises/images/pencil.png";u.onload=function(){backBtnIcon=new n.Image({shadowColor:"#a2bd30",shadowBlur:2,shadowOffset:{x:5,y:5},shadowOpacity:.3,x:0,y:0,image:u,width:25,height:25});var t=new n.Circle({radius:19,x:0,y:0,fill:"#ffffff",stroke:"#847f7f",strokeWidth:1.5});grpPencil.add(t);grpPencil.add(backBtnIcon);grpPencil.name="pencil";grpPencil.on("click tap",s);grpPencil.on("mouseover",iconHover);grpPencil.on("mouseout",iconOut);grpPencil.visible(!1);layer.add(grpPencil);layer.draw()};grpErase=new n.Group;f=new Image;f.src="files/kymppi/exercises/images/eraser.png";f.onload=function(){eraseBtnIcon=new n.Image({shadowColor:"#a2bd30",shadowBlur:2,shadowOffset:{x:5,y:5},shadowOpacity:.5,x:0,y:0,image:f,width:25,height:25});var t=new n.Circle({radius:19,x:0,y:0,fill:"#ffffff",stroke:"#847f7f",strokeWidth:1.5});grpErase.add(t);grpErase.add(eraseBtnIcon);grpErase.name="eraser";grpErase.on("click tap",s);grpErase.on("mouseover",iconHover);grpErase.on("mouseout",iconOut);grpErase.visible(!1);layer.add(grpErase);layer.draw()};grpTrash=new n.Group;e=new Image;e.src="files/kymppi/exercises/images/clear.png";e.onload=function(){trashBtnIcon=new n.Image({shadowColor:"#a2bd30",shadowBlur:2,shadowOffset:{x:5,y:5},shadowOpacity:.5,x:0,y:0,image:e,width:25,height:25});var t=new n.Circle({radius:19,x:0,y:0,fill:"#ffffff",stroke:"#847f7f",strokeWidth:1.5});grpTrash.add(t);grpTrash.add(trashBtnIcon);grpTrash.name="trash";grpTrash.on("click tap",s);grpTrash.on("mouseover",iconHover);grpTrash.on("mouseout",iconOut);grpTrash.visible(!1);layer.add(grpTrash);layer.draw();reTransEditText()};stage.add(layer);var t,h=!1,c=stage.getContent().firstChild;$(document).on("mouseover","canvas",function(){document.body.style.cursor="text"});$(document).on("mouseout","canvas",function(){document.body.style.cursor="default"});$(document).on("mousedown",function(n){t!==undefined&&(t.unfocus(n),t=undefined)});$(document).on("mousedown","canvas",function(n){try{t!==undefined&&(t.checkClick()?(t.findCursorPosFromClick(!0),h=!0):(h=!1,t.unfocus(n)))}catch(n){return!1}return!1});$(".kineticjs-content canvas").on("mouseup",function(r){var e,u,s,c,f;if(!h&&$("#container-editText").children().length!=0){if(isFirst==!0){isFirst=!1;return}if($("#drawingTool").attr("class")!="iconHover")if(t!==undefined)t=undefined;else try{e=new n.Group;u=new n.EditableText({x:r.pageX+i().left+5,y:r.pageY+i().top-5,fontFamily:"Arial",fontSize:40,fill:"#000000",focusRectColor:"#808080"});e.add(u);s=new n.Rect({x:r.pageX+i().left,y:r.pageY+i().top-10,width:50,height:50,stroke:"#808080",strokeWidth:1,listening:!1});s.hide();e.add(s);c=new Image;c.src="files/kymppi/exercises/images/close.png";f=new n.Image({x:r.pageX+i().left-15,y:r.pageY+i().top-25,image:c,width:30,height:30});f.hide();e.add(f);layer.add(e);stage.add(layer);u.focus();t=u;layer.draw();u.on("click",function(n){return o(),n.cancelBubble=!0,this.focus(),t=this,!1});u.on("mouseover",function(n){isHoverEditText=!0;n.target.parent.children[2].setX(n.target.parent.children[1].attrs.x+this.focusRectW-30);n.target.parent.children[2].show();n.target.parent.children[1].attrs.width=this.focusRectW-10;n.target.parent.children[1].attrs.height=this.totalLines*this.lineHeightPx+5;n.target.parent.children[1].show();layer.draw()});u.on("mouseout",function(n){isHoverEditText=!1;n.target.parent.children[1].hide();n.target.parent.children[2].hide();layer.draw()});f.on("mouseover",function(n){isHoverEditText=!0;isFirst=!0;document.body.style.cursor="default";n.target.parent.children[1].show();n.target.parent.children[2].show();layer.draw()});f.on("mouseout",function(n){isHoverEditText=!1;isFirst=!1;document.body.style.cursor="text";n.target.parent.children[1].hide();n.target.parent.children[2].hide();layer.draw()});f.on("click",function(n){var i,r=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,t;r==!1?(t=window.event,t.which?i=t.which==3:t.button&&(i=t.button==2)):i=!1;i==!1&&(isFirst=!0,n.target.parent.hide(),layer.draw())})}catch(r){console.log(r)}}})}var isIE,isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox=typeof InstallTrigger!="undefined",isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome=!!window.chrome&&!isOpera,isEdge=navigator.userAgent.indexOf(" Edge/")>=0||navigator.userAgent.indexOf(" edge/")>=0,isIExplorer=!1||!!document.documentMode,clickHandler="ontouchstart"in document.documentElement?"touchstart":"click",isiPad=navigator.userAgent.match(/iPad/i)!=null,pencilColor=new createjs.Container,pencilDrawcolor="#000000",pencilVisible=!1,pageLink="",drawingStage,drawingToolbar,pencil,eraser;clickHandler="click";isIExplorer&&($("html").addClass("ie"),$("html").addClass("ie"+document.documentMode),IEVersion=document.documentMode);isEdge&&$("html").addClass("ie ieedge");isSafari&&$("html").addClass("safari "+isiPhone());$(document).ready(function(){isIE=/*@cc_on!@*/!1||!!document.documentMode;var n="";localStorage.setItem("isPdfpage",n);$(".lyssna").click(function(){var t=window.location.href.split("?");pageLink=window.location.href;localStorage.setItem("isPagelink",pageLink);t.length==2&&(window.open(t[0],"_self",!1),n="true",localStorage.setItem("isPdfpage",n))});$(".index_navPdf").click(function(){var t=window.location.href.split("?");t.length==2&&(window.open(t[0],"_self",!1),n="false",localStorage.setItem("isPdfpage",n))});$(".Pdf_Backbtn").click(function(){localStorage.getItem("isPagelink")!=""&&(window.open(localStorage.getItem("isPagelink"),"_self",!1),n="false",localStorage.setItem("isPdfpage",n),pageLink="",localStorage.setItem("isPagelink",pageLink))});$(".matteladan").click(function(){$(".matteladan img").attr("src")==$(".matteladan img").attr("data-hover-on")&&($("#dropdown1").toggle(),$(".matteladan img").attr("src",$(".matteladan img").attr("data-hover-off")))});$(".vilar").click(function(){$(".vilar img").attr("src")==$(".vilar img").attr("data-hover-on")&&($("#dropdownvilar").toggle(),$(".vilar img").attr("src",$(".vilar img").attr("data-hover-off")))});$(".viovar").click(function(){$(".viovar img").attr("src")==$(".viovar img").attr("data-hover-on")&&($("#dropdownviovar").toggle(),$(".viovar img").attr("src",$(".viovar img").attr("data-hover-off")))});$("#toggle").on("click",function(){$("#toolbar").attr("class").indexOf("toolbarToggled")>-1?($("#toolbar").removeClass("toolbarToggled"),$(".page").removeClass("pageToggled"),$("#toggle").removeClass("toggled")):($("#toolbar").addClass("toolbarToggled"),$(".page").addClass("pageToggled"),$("#toggle").addClass("toggled"))});$("#dropdown2.dropdown-content li, #dropdown1.dropdown-content li").click(function(){$("#toggleEditor").hide();$("#toggler").hide();var n=$(this).attr("data-exercise");$("#modalMatteladan").attr("data-current-chapter",n);$($("#toggleEditor").parent()[0]).addClass("inPopup");$("#modalMatteladan").find("iframe")[0].src="preloader.html?iframe=true";$("#modalMatteladan").openModal({ready:function(){$("#modalMatteladan").openModal({ready:function(){var t="/mathviewer-FK/files/kymppi/tincan/"+n+".html?iframe=true";$("#modalMatteladan").find("iframe")[0].src=t;$(".slider").slider({interval:864e5,full_width:!0,indicators:!1});$("#modalMatteladan .indicators").remove();setTimeout(function(){$("#toggleEditor").show();$("#toggler").show()},500);clearEditTextContent()},complete:function(){for(var t,n=$(".lean-overlay").length-1;n>=0;n--)$($(".lean-overlay")[n]).remove();$($("#toggleEditor").parent()[0]).removeClass("inPopup");$("#modalMatteladan").find("iframe")[0].src="preloader.html?iframe=true";t=window.location.href.split("=");t[1]=="files/toc/toc.html"&&($("#toggleEditor").hide(),$("#toggler").hide());clearEditTextContent()}})}})});$("#dropdownvilar.dropdown-content li").click(function(){$("#toggleEditor").hide();$("#toggler").hide();var n=$(this).attr("data-exercise");$("#modalViLar").attr("data-current-chapter",n);$("#modalViLar").attr("tabCount",$(this).attr("data-tabCount"));$($("#toggleEditor").parent()[0]).addClass("inPopup");$("#modalViLar").find("iframe")[0].src="preloader.html?iframe=true";$($("#modalViLar .tabs li")[1]).addClass("hidden");$($($("#modalViLar .tabs li")[0]).find("a")[0]).text("");$("#modalViLar .tabs").css("background-color","#ffffff");$("#modalViLar").openModal({ready:function(){$("#modalViLar").openModal({ready:function(){$("#modalViLar").attr("tabCount")=="2"&&($("#modalViLar .tabs").css("background-color","#DDDDE3"),$($("#modalViLar .tabs li")[1]).removeClass("hidden").addClass("shown"),$($($("#modalViLar .tabs li")[0]).find("a")[0]).text("Räknehändelser addition"),$($($("#modalViLar .tabs li")[1]).find("a")[0]).text("Räknehändelser subtraktion"));var t="/mathviewer-FK/files/kymppi/exercises/"+n+".html?iframe=true";$("#modalViLar").find("iframe")[0].src=t;$(".slider").slider({interval:864e5,full_width:!0,indicators:!1});$("#modalViLar .indicators").remove();setTimeout(function(){$("#toggleEditor").show();$("#toggler").show()},500);clearEditTextContent()},complete:function(){for(var t,n=$(".lean-overlay").length-1;n>=0;n--)$($(".lean-overlay")[n]).remove();$($("#toggleEditor").parent()[0]).removeClass("inPopup");$("#modalViLar").find("iframe")[0].src="preloader.html?iframe=true";t=window.location.href.split("=");t[1]=="files/toc/toc.html"&&($("#toggleEditor").hide(),$("#toggler").hide());clearEditTextContent()}})}})});$("#dropdownviovar.dropdown-content li").click(function(){$("#toggleEditor").hide();$("#toggler").hide();var n=$(this).attr("data-exercise");$("#modalViOvar").attr("data-current-chapter",n);$($("#toggleEditor").parent()[0]).addClass("inPopup");$("#modalViOvar").find("iframe")[0].src="preloader.html?iframe=true";$("#modalViOvar").openModal({ready:function(){$("#modalViOvar").openModal({ready:function(){var t="/mathviewer-FK/files/kymppi/viovar/"+n+".html?iframe=true";$("#modalViOvar").find("iframe")[0].src=t;$(".slider").slider({interval:864e5,full_width:!0,indicators:!1});$("#modalViOvar .indicators").remove();setTimeout(function(){$("#toggleEditor").show();$("#toggler").show()},500);clearEditTextContent()},complete:function(){for(var t,n=$(".lean-overlay").length-1;n>=0;n--)$($(".lean-overlay")[n]).remove();$($("#toggleEditor").parent()[0]).removeClass("inPopup");$("#modalViOvar").find("iframe")[0].src="preloader.html?iframe=true";t=window.location.href.split("=");t[1]=="files/toc/toc.html"&&($("#toggleEditor").hide(),$("#toggler").hide());clearEditTextContent()}})}})});$(document).on("keydown",function(n){n.which===8&&isEdge==!0&&n.preventDefault()})});$("#copyright").on("click",function(){$("#modalCopyright").openModal()});$("#jquery_jplayer_1").jPlayer({ready:function(){},swfPath:"lib",supplied:"m4a, oga, mp3",wmode:"window",useStateClassSkin:!0,autoBlur:!1,smoothPlayBar:!0,keyEnabled:!1,remainingDuration:!0,toggleDuration:!0});$(".tabContent").height($(".modal").height()-$(".tabs").height()-20);$(".slider").on("click",function(){for(var n=0;n<$(".slides li iframe").length;n++)$(".slides li iframe")[n].src=$(".slides li iframe")[n].src});$(document).on("click",".tab",function(n){var t=n;isIE?activateTabs(n):setTimeout(activateTabs(n),400)});$(document).on("click","#toggleEditor",function(){$("#drawingTool").attr("class")==""?(erase=!1,drawingStage.children[2].visible=!1,drawingStage.children[3].visible=!1,drawingStage.toolWidth=4,showEditText(),setETxtIconVisiblity(!1),addEnterKeyFocusForPopUp()):$("#drawingTool").attr("class")=="invisible"&&setETxtIconVisiblity(!0);isFirst=!1;$("#toggler label").toggleClass("active");$("#drawingTool").toggleClass("invisible")});forwardStarted=!1;drawingStage=new createjs.Stage("canvas");drawingToolbar=new createjs.Container;drawingStage.enableMouseOver(20);createjs.Touch.enable(drawingStage);createjs.Ticker.setFPS(24);var erase=!1,drawingStageImages={},lib={},drawingStageManifest=[{src:"files/kymppi/exercises/images/pencil.png",id:"pencil"},{src:"files/kymppi/exercises/images/eraser.png",id:"eraser"},{src:"files/kymppi/exercises/images/clear.png",id:"clearScreen"},{src:"files/kymppi/exercises/images/lasso.png",id:"lasso"},{src:"files/kymppi/exercises/images/color.png",id:"color"},{src:"files/kymppi/exercises/images/text_T.png",id:"text_T"}];init();addEditableText();showEditText();var stage,backBtnIcon,layer,txtBtnIcon,grpPencil,grpTrash,grpErase,grpTxt,isEditTextLayer=!0,isHoverEditText=!1,isFirst=!0;