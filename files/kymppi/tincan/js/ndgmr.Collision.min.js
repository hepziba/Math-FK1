this.ndgmr=this.ndgmr||{},function(){var i=document.createElement("canvas"),o=i.getContext("2d"),n,f,r,e,s,t;o.save();n=document.createElement("canvas");f=n.getContext("2d");f.save();r=[];e=function(n,i){var r,u;return r=t(n),u=t(i),c(r,u)};ndgmr.checkRectCollision=e;s=function(t,r,u,s){(ndgmr.DEBUG||ndgmr.DEBUG_COLLISION)&&(document.body.appendChild(i),document.body.appendChild(n));s=s||!1;var a,v,c;if(intersection=e(t,r),!intersection)return!1;if(u=u||0,u=Math.min(.99999,u),i.width=intersection.width,i.height=intersection.height,n.width=intersection.width,n.height=intersection.height,a=h(intersection,t,o,1),v=h(intersection,r,f,2),c=l(a,v,intersection.width,intersection.height,u,s),c)c.x+=intersection.x,c.x2+=intersection.x,c.y+=intersection.y,c.y2+=intersection.y;else return!1;return c};ndgmr.checkPixelCollision=s;var a=function(n,t){var i,r,u,f;return u=n.localToGlobal(0,0),f=t.localToGlobal(0,0),i=n instanceof createjs.Bitmap?{width:n.image.width,height:n.image.height}:n.spriteSheet.getFrame(n.currentFrame).rect,r=t instanceof createjs.Bitmap?{width:t.image.width,height:t.image.height}:t.spriteSheet.getFrame(t.currentFrame).rect,Math.abs(f.x-u.x)<r.width*t.scaleX+i.width*n.scaleX&&Math.abs(f.y-u.y)<r.height*t.scaleY+i.height*t.scaleY},h=function(n,t,i,f){var h,e,s,o;return t instanceof createjs.Bitmap?e=t.image:t instanceof createjs.Sprite&&(frame=t.spriteSheet.getFrame(t.currentFrame),s=frame.image.src+":"+frame.rect.x+":"+frame.rect.y+":"+frame.rect.width+":"+frame.rect.height,r[s]?e=r[s]:r[s]=e=createjs.SpriteSheetUtils.extractFrame(t.spriteSheet,t.currentFrame)),h=t.globalToLocal(n.x,n.y),i.restore(),i.save(),i.rotate(u(t,"rotation")*(Math.PI/180)),i.scale(u(t,"scaleX","*"),u(t,"scaleY","*")),i.translate(-h.x-n["rect"+f].regX,-h.y-n["rect"+f].regY),(o=t.sourceRect)!=undefined?i.drawImage(e,o.x,o.y,o.width,o.height,0,0,o.width,o.height):i.drawImage(e,0,0,e.width,e.height),i.getImageData(0,0,n.width,n.height).data},l=function(n,t,i,r,u,f){for(var c,l,o,h=3,e={x:Infinity,y:Infinity,x2:-Infinity,y2:-Infinity},s=0;s<r;++s)for(o=0;o<i;++o){if(c=n.length>h+1?n[h]/255:0,l=t.length>h+1?t[h]/255:0,c>u&&l>u)if(f)o<e.x&&(e.x=o),o>e.x2&&(e.x2=o),s<e.y&&(e.y=s),s>e.y2&&(e.y2=s);else return{x:o,y:s,width:1,height:1};h+=4}return e.x!=Infinity?(e.width=e.x2-e.x+1,e.height=e.y2-e.y+1,e):null},u=function(n,t,i){if(i=i||"+",n.parent&&n.parent[t]){var r=n[t],f=u(n.parent,t,i);return i=="*"?r*f:r+f}return n[t]},c=function(n,t){var u,f,i={},r={};return i.cx=n.x+(i.hw=n.width/2),i.cy=n.y+(i.hh=n.height/2),r.cx=t.x+(r.hw=t.width/2),r.cy=t.y+(r.hh=t.height/2),u=Math.abs(i.cx-r.cx)-(i.hw+r.hw),f=Math.abs(i.cy-r.cy)-(i.hh+r.hh),u<0&&f<0?(u=Math.min(Math.min(n.width,t.width),-u),f=Math.min(Math.min(n.height,t.height),-f),{x:Math.max(n.x,t.x),y:Math.max(n.y,t.y),width:u,height:f,rect1:n,rect2:t}):null};ndgmr.calculateIntersection=c;t=function(n){var i={x:Infinity,y:Infinity,width:0,height:0},l,v,u,c,f,e,o,s,r,a,h;if(n instanceof createjs.Container){for(i.x2=-Infinity,i.y2=-Infinity,l=n.children,v=l.length,c=0;c<v;c++)u=t(l[c]),u.x<i.x&&(i.x=u.x),u.y<i.y&&(i.y=u.y),u.x+u.width>i.x2&&(i.x2=u.x+u.width),u.y+u.height>i.y2&&(i.y2=u.y+u.height);i.x==Infinity&&(i.x=0);i.y==Infinity&&(i.y=0);i.x2==Infinity&&(i.x2=0);i.y2==Infinity&&(i.y2=0);i.width=i.x2-i.x;i.height=i.y2-i.y;delete i.x2;delete i.y2}else r={},n instanceof createjs.Bitmap?(a=n.sourceRect||n.image,r.width=a.width,r.height=a.height):n instanceof createjs.Sprite?n.spriteSheet._frames&&n.spriteSheet._frames[n.currentFrame]&&n.spriteSheet._frames[n.currentFrame].image?(h=n.spriteSheet.getFrame(n.currentFrame),r.width=h.rect.width,r.height=h.rect.height,r.regX=h.regX,r.regY=h.regY):(i.x=n.x||0,i.y=n.y||0):(i.x=n.x||0,i.y=n.y||0),r.regX=r.regX||0,r.width=r.width||0,r.regY=r.regY||0,r.height=r.height||0,i.regX=r.regX,i.regY=r.regY,f=n.localToGlobal(0-r.regX,0-r.regY),e=n.localToGlobal(r.width-r.regX,r.height-r.regY),o=n.localToGlobal(r.width-r.regX,0-r.regY),s=n.localToGlobal(0-r.regX,r.height-r.regY),i.x=Math.min(Math.min(Math.min(f.x,e.x),o.x),s.x),i.y=Math.min(Math.min(Math.min(f.y,e.y),o.y),s.y),i.width=Math.max(Math.max(Math.max(f.x,e.x),o.x),s.x)-i.x,i.height=Math.max(Math.max(Math.max(f.y,e.y),o.y),s.y)-i.y;return i};ndgmr.getBounds=t}();